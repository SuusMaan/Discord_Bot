name: Discord Notifications

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, reopened, closed]

jobs:
  discord-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification (Commit)
        uses: rjstone/discord-webhook-notify@v1.0.0
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK_URL }}
          embeds: |
            [
              {
                "title": "Новый коммит в ${{ github.repository }}",
                "description": "${{ github.event.head_commit.message }}",
                "color": 5814783,  # Зеленый цвет
                "fields": [
                  {
                    "name": "Автор",
                    "value": "${{ github.actor }}",
                    "inline": true
                  },
                  {
                    "name": "URL коммита",
                    "value": "${{ github.event.head_commit.url }}",
                    "inline": true
                  }
                ],
                "timestamp": "${{ github.event.head_commit.timestamp }}"
              }
            ]
        if: github.event_name == 'push'

      - name: Send Discord PR Notification
        if: github.event_name == 'pull_request'
        uses: rjstone/discord-webhook-notify@v1.0.0
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK_URL }}
          embeds: |
            [
              {
                "title": "Pull Request: ${{ github.event.pull_request.title }}",
                "description": "Pull Request by ${{ github.actor }} is ${{ github.event.action }}",
                "color": 3447003,  # Синий цвет
                "fields": [
                  {
                    "name": "PR URL",
                    "value": "${{ github.event.pull_request.html_url }}"
                  }
                ],
                "timestamp": "${{ github.event.pull_request.created_at }}"
              }
            ]